(function(){angular.module("spapp",["ngRoute","ngSanitize","ui.bootstrap"]);function e(e,t,n){e.when("/",{templateUrl:"/views/home.view.html",controller:"homeCtrl",controllerAs:"vm"}).when("/locations/:locationid",{templateUrl:"/views/locationDetails.view.html",controller:"locationDetailsCtrl",controllerAs:"vm"}).when("/about",{templateUrl:"/commons/views/generic.view.html",controller:"aboutCtrl",controllerAs:"vm"}).when("/register",{templateUrl:"/views/register.view.html",controller:"registerCtrl",controllerAs:"vm"}).when("/login",{templateUrl:"/views/login.view.html",controller:"loginCtrl",controllerAs:"vm"}).otherwise({redirectTo:"/"});t.html5Mode({enabled:true,requireBase:false});n.errorOnUnhandledRejections(false)}angular.module("spapp").config(["$routeProvider","$locationProvider","$qProvider",e])})();(function(){angular.module("spapp").controller("homeCtrl",e);e.$inject=["$scope","dataService","geoService"];function e(e,t,n){var a=this;a.pageHeader={title:"Mean PG",strapline:": free nearby WiFi spots"};a.sidebar={content:"Looking for wifi and a seat? We help you find places to work when out and about."+"Perhaps with coffee, cake or a pint? Let us help you find the place you're looking for."};a.message="Checking location ...";a.getData=function(e){var n=e.coords.latitude;var o=e.coords.longitude;a.message="Searching for nearby places";t.getLocations(n,o).then(function(e){a.message=e.data.length>0?"":"No locations found";a.data={locations:e.data}},function(e){a.message="Sorry, something's gone wrong ";console.log(e)})};a.showError=function(t){e.$apply(function(){a.message=t.message})};a.noGeo=function(){e.$apply(function(){a.message="Geolocation not supported by browser."})};n.getPosition(a.getData,a.showError,a.noGeo)}})();(function(){angular.module("spapp").controller("aboutCtrl",e);function e(){var e=this;e.pageHeader={title:"About Mean PG"};e.main={content:"Mean PG App was created to help people find places to sit down and get a bit of work done.\n\nLorem ipsum dolor sit amet, consectetur adipiscing elit. Nunc sed lorem ac nisi dignissim accumsan. Nullam sit amet interdum magna. Morbi quis faucibus nisi. Vestibulum mollis purus quis eros adipiscing tristique. Proin posuere semper tellus, id placerat augue dapibus ornare. Aenean leo metus, tempus in nisl eget, accumsan interdum dui. Pellentesque sollicitudin volutpat ullamcorper.\n\nSuspendisse tincidunt, lectus non suscipit pharetra, purus ipsum vehicula sapien, a volutpat mauris ligula vel dui. Proin varius interdum elit, eu porttitor quam consequat et. Quisque vitae felis sed ante fringilla fermentum in vitae sem. Quisque fermentum metus at neque sagittis imperdiet. Phasellus non laoreet massa, eu laoreet nibh. Pellentesque vel magna vulputate, porta augue vel, dapibus nisl. Phasellus aliquet nibh nec nunc posuere fringilla. Quisque sit amet dignissim erat. Nulla facilisi. Donec in sollicitudin ante. Cras rhoncus accumsan rutrum. Sed aliquet ligula dui, eget laoreet turpis tempor vitae."}}})();(function(){angular.module("spapp").controller("locationDetailsCtrl",e);e.$inject=["$routeParams","$location","$uibModal","dataService","authService"];function e(e,t,n,a,o){var r=this;r.locationid=e.locationid;r.currentPath=t.path();r.pageHeader={title:r.locationid};r.message="Retrieving location ...";r.isLoggedIn=o.isLoggedIn();a.getLocationById(r.locationid).then(function(e){r.message=e.data.length>0?"":"No locations found";r.data={location:e.data};r.pageHeader={title:r.data.location.name}},function(e){r.message="Sorry, something's gone wrong ";console.log(e)});r.openReviewForm=function(){var e=n.open({templateUrl:"/views/reviewModal.view.html",controller:"reviewModalCtrl as vm",resolve:{locationData:function(){return{locationId:r.locationid,locationName:r.data.location.name}}}});e.result.then(function(e){console.log(e.data);var t=[];r.data.location.reviews.push(e.data)})}}})();(function(){angular.module("spapp").controller("reviewModalCtrl",e);e.$inject=["$uibModalInstance","dataService","locationData"];function e(e,t,n){var a=this;a.locationData=n;a.modal={close:function(t){e.close(t)},cancel:function(){e.dismiss("cancel")}};a.onSubmit=function(){a.formError="";if(!a.formData.rating||!a.formData.reviewText){a.formError="All fields required, please try again";return false}else{console.log(a.formData);a.addReview(a.locationData.locationId,a.formData)}};a.addReview=function(e,n){t.addReview(e,{rating:n.rating,reviewText:n.reviewText}).then(function(e){console.log("Review successfully saved.");a.modal.close(e)},function(e){a.formError="Error saving review, try again."});return false}}})();(function(){angular.module("spapp").controller("registerCtrl",e);e.$inject=["$location","authService"];function e(e,t){var n=this;n.pageHeader={title:" Mean PG user account registration"};n.credentials={name:"",email:"",password:""};n.returnPage=e.search().page||"/";n.onSubmit=function(){n.formError="";if(!n.credentials.name||!n.credentials.email||!n.credentials.password){n.formError="All fields required, please try again";return false}else{n.register()}};n.register=function(){n.formError="";t.register(n.credentials).then(function(a){console.log("Register user: "+JSON.stringify(a.data));t.saveToken(a.data.token);e.search("page",null);e.path(n.returnPage)},function(e){n.formError=e})}}})();(function(){angular.module("spapp").controller("loginCtrl",e);e.$inject=["$location","authService"];function e(e,t){var n=this;n.pageHeader={title:" Mean PG user account login"};n.credentials={email:"",password:""};n.returnPage=e.search().page||"/";n.onSubmit=function(){n.formError="";if(!n.credentials.email||!n.credentials.password){n.formError="All fields required, please try again";return false}else{n.login()}};n.login=function(){n.formError="";t.login(n.credentials).then(function(a){t.saveToken(a.data.token);e.search("page",null);e.path(n.returnPage)},function(e){n.formError=e})}}})();(function(){angular.module("spapp").directive("ratingStars",e);function e(){return{restrict:"EA",scope:{thisRating:"=rating"},templateUrl:"/commons/directives/templates/ratingStars.template.html"}}})();(function(){angular.module("spapp").directive("pageHeader",e);function e(){return{restrict:"EA",scope:{content:"=content"},templateUrl:"/commons/directives/templates/pageHeader.template.html"}}})();(function(){angular.module("spapp").directive("pageFooter",e);function e(){return{restrict:"EA",templateUrl:"/commons/directives/templates/pageFooter.template.html"}}})();(function(){angular.module("spapp").directive("navigation",e);function e(){return{restrict:"EA",templateUrl:"/commons/directives/templates/navigation.template.html",controller:"navigationCtrl as navvm"}}})();(function(){angular.module("spapp").controller("navigationCtrl",e);e.$inject=["$location","authService"];function e(e,t){var n=this;n.currentPath=e.path();n.isLoggedIn=t.isLoggedIn();n.currentUser=t.getCurrentUser();n.logout=function(){t.logout();e.path("/")}}})();(function(){angular.module("spapp").filter("formatDistance",t);var e=function(e){return!isNaN(parseFloat(e))&&isFinite(e)};function t(){return function(t){var n,a;if(t&&e(t)){if(t>1){n=parseFloat(t).toFixed(1);a="km"}else{n=parseInt(t*1e3,10);a="m"}return n+a}else{return"?"}}}})();(function(){angular.module("spapp").filter("transformLineBreaks",e);function e(){return function(e){var t=e.replace(/\n/g,"<br/>");return t}}})();(function(){angular.module("spapp").service("dataService",e);e.$inject=["$http","authService"];function e(e,t){var n=function(t,n){return e.get("/api/locations?lat="+t+"&lng="+n+"&radius=20")};var a=function(t){return e.get("/api/locations/"+t)};var o=function(n,a){return e.post("/api/locations/"+n+"/reviews",a,{headers:{Authorization:"Bearer "+t.getToken()}})};return{getLocations:n,getLocationById:a,addReview:o}}})();(function(){angular.module("spapp").service("geoService",e);function e(){var e=function(e,t,n){if(navigator.geolocation){navigator.geolocation.getCurrentPosition(e,t)}else{n()}};return{getPosition:e}}})();(function(){angular.module("spapp").service("authService",e);e.$inject=["$http","$window"];function e(e,t){var n=function(e){t.localStorage["mean-spa-token"]=e};var a=function(){return t.localStorage["mean-spa-token"]};var o=function(t){return e.post("/api/register",t)};var r=function(t){return e.post("/api/login",t)};var i=function(){t.localStorage.removeItem("mean-spa-token")};var l=function(){var e=a();if(e){var n=JSON.parse(t.atob(e.split(".")[1]));return n.exp>Date.now()/1e3}else{return false}};var s=function(){if(l()){var e=a();var n=JSON.parse(t.atob(e.split(".")[1]));return{name:n.name,email:n.email}}};return{saveToken:n,getToken:a,register:o,login:r,logout:i,isLoggedIn:l,getCurrentUser:s}}})();